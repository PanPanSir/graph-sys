generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "windows"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model t_vs_project {
  id             Int       @id @default(autoincrement())
  name           String    @unique @db.VarChar(64)
  description    String?   @db.VarChar(255)
  contextPath    String?   @unique @db.VarChar(600) @map("context_path")
  compileVersion Int       @default(0) @map("compile_version")
  method         String?   @db.VarChar(8)
  properties     Json?
  state          String?   @db.VarChar(12)
  createTime     DateTime  @default(now()) @map("create_time")
  modifyTime     DateTime  @updatedAt @map("modify_time")

  @@index([contextPath, id, compileVersion], name: "context_id_version")
}

model t_vs_port {
  id               String    @id @db.VarChar(64)
  projectId        Int       @map("project_id")
  nodeId           String    @map("node_id") @db.VarChar(64)
  type             String    @db.VarChar(16)
  properties       Json
  // contextCompApiId Int?      @map("context_comp_api_id")
  method           String?   @db.VarChar(8)
  path             String?   @db.VarChar(128)
  // httpCompApiId    Int?      @map("http_comp_api_id")
  sourceApiType    String?   @map("source_api_type") @db.VarChar(12)
  targetApiType    String?   @map("target_api_type") @db.VarChar(12)
  sourceApiId      Int?      @map("source_api_id")
  targetApiId      Int?      @map("target_api_id")
  createTime       DateTime  @default(now()) @map("create_time")
  modifyTime       DateTime  @updatedAt @map("modify_time")

  @@index([projectId])
  @@index([nodeId])
  @@index([sourceApiId])
  @@index([targetApiId])
  @@index([targetApiType, targetApiId], name:"target_api_type_api_id")
  @@index([sourceApiType, sourceApiId], name:"source_api_type_api_id")
  // @@index([method, path], name:"method_path")
  // @@index([httpCompApiId], name:"http_api_id")
}

model t_vs_node {
  id             String    @id @db.VarChar(64)
  projectId      Int       @map("project_id")
  taskType       String    @map("task_type") @db.VarChar(16)
  script         String    @db.LongText
  classBytes     Bytes     @map("class_bytes") @db.LongBlob
  properties     Json
  viewType       String    @map("view_type") @db.VarChar(16)
  upLevelNodeId  String    @map("up_level_node_id") @db.VarChar(64)
  createTime     DateTime  @default(now()) @map("create_time")
  modifyTime     DateTime  @updatedAt @map("modify_time")

  @@index([projectId])
  @@index([upLevelNodeId])
}

model t_vs_link {
  id           String    @id @db.VarChar(64)
  projectId    Int       @map("project_id")
  sourceId  String    @map("start_node_id") @db.VarChar(64)
  targetId    String    @map("end_node_id") @db.VarChar(64)
  sourcePort  String    @map("start_port_id") @db.VarChar(64)
  targetPort    String    @map("end_port_id") @db.VarChar(64)
  properties   Json
  createTime   DateTime  @default(now()) @map("create_time")
  modifyTime   DateTime  @updatedAt @map("modify_time")

  @@index([projectId])
  @@index([targetId])
  @@unique([sourcePort, targetPort], name:"start_end_branch_uinq")
  @@unique([sourceId], name:"start_branch_id")
}